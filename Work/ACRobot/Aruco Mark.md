Aruco 码是一种常用的 **二进制方形视觉标记（fiducial marker）**，它的设计目标是：

* 通过相机识别后，能够快速、准确地检测出位置和身份；
* 还能用于相机姿态估计[[SolvePnP]]（PnP 问题）、机器人定位与导航、手眼标定等。

下面我给你系统解释它的工作原理：

---

## 1. Aruco码的结构

Aruco码是一个黑白方形图案，整体是一个正方形区域，通常包含以下部分：

1. **外边框（border）**

   * 通常为一圈黑色边框，保证在图像中容易检测到方形区域。
2. **编码区域（binary code）**

   * 内部是一个小型的黑白二值矩阵（如 4×4、5×5、6×6）。
   * 每个小方格表示 0（白）或 1（黑）。
3. **字典（dictionary）**

   * Aruco码的图案不是随意生成的，而是从预定义的字典集合中挑选。
   * 每个字典中有多个码，每个码之间的汉明距离（Hamming Distance）足够大，确保检测时即使有噪声或遮挡，也能区分开来。

---

## 2. 检测流程

相机捕捉到图像后，Aruco 码的检测分为几个步骤：

1. **边缘检测与候选区域提取**

   * 使用阈值分割 + 轮廓检测，找到近似方形的区域。
   * 通过几何约束（正方形、边长比例等）筛选出候选区域。

2. **透视变换（perspective transform）**

   * 将检测到的四边形区域做透视矫正，把它还原成一个标准的正方形。
   * 这样便于读取内部的二值矩阵。

3. **二值化与采样**

   * 把正方形分割成小网格（比如 6×6）。
   * 读取每个网格的黑白值，得到一个二进制矩阵。

4. **码字识别**

   * 将读取到的二进制矩阵与字典中的码本进行匹配。
   * 通过最小汉明距离判断是哪一个 Aruco 码。
   * 如果距离小于容错阈值，则判定为识别成功。

---

## 3. 姿态估计（Pose Estimation）

检测到 Aruco 码后，如果已知：

* 相机[[Camera]]的 **内参矩阵 K**（焦距 fx, fy，主点 cx, cy）；
* Aruco 码的 **实际物理边长（比如 5 cm）**；

那么可以通过 **PnP（Perspective-n-Point）算法** 计算相机与 Aruco 码之间的相对姿态：

* **旋转矩阵 R**（相机与标记的旋转关系）
* **平移向量 t**（相机在标记坐标系下的位置）

这在机器人定位、手眼标定、AR 增强现实中非常有用。

---

## 4. 特点与优势

* **鲁棒性**：黑白对比强烈，容易检测；字典设计保证抗误识别能力。
* **速度快**：检测算法基于简单的图像处理（阈值、透视变换、二值化），可以实时运行。
* **可扩展**：字典可根据需要生成不同数量、不同尺寸的码。
* **可解姿态**：不仅能识别 ID，还能用于三维姿态估计。

---

✅ 总结：
Aruco码本质上是 **一种带有冗余编码的黑白矩阵标记**。相机检测时通过边缘检测找到方形区域，透视矫正后读取二值矩阵，再通过字典比对识别出 ID，结合相机内参还能进一步求解空间位姿。


